#script will run once a month for backup DKMS Kiosk application
#backup Kiosk and TMS config

function BackupConfig {
#DKMS_file
$dkmsOldfile = "C:\DKMSClient\kiosk.ini", "C:\DKMSClient\AppSettings.config", "C:\DKMSClient\DKMSKiosk.exe.config"
$dkmsRemediationfile = "C:\DKMSRemediation\appsettings.json", "C:\DKMSRemediation\kiosk.ini"

#SBC_FILE
$sbcRemediationfile = "C:\SBCRemediation\appsettings.json", "C:\SBCRemediation\Config.xml"
$tmsfile = "C:\DKMSRemediationTMS\appsettings.json", "C:\DKMSRemediationTMS\kiosk.ini"

$filedate = Get-Date -Format "ddMMMMyyyy"
#$source = 'C:\_Maintenance\BackupConfig_$formattedDateTime'
$kiosk = "$env:COMPUTERNAME" 

if(test-path 'C:\DKMSClient')
    {
    New-Item -Path "C:\_Maintenance\BackupConfig\$filedate\$kiosk" -ItemType Directory
    Compress-Archive -Path $dkmsOldfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\Clientbackup"
    Write-Output "DKMSClient config backup successfully!"
    }

        elseif(test-path 'C:\DKMSRemediation')
        { 
        New-Item -Path "C:\_Maintenance\BackupConfig\$filedate\$kiosk" -ItemType Directory
        Compress-Archive -Path $dkmsRemediationfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\Clientbackup"
        Write-Output "DKMSRemediation config backup successfully!"
                if(test-path 'C:\DKMSRemediationTMS'){
                    Compress-Archive -Path $tmsfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\TMSbackup"
                    Write-Output "TMS config backup done!"
                    }
        }

            elseif(test-path 'C:\DKMS')
            { 
           New-Item -Path "C:\_Maintenance\BackupConfig\$filedate\$kiosk" -ItemType Directory
            Compress-Archive -Path $dkmsmbfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\Clientbackup"
            Write-Output "DKMS config backup successfully!"
           
            }

                elseif (test-path 'C:\SBCApp')
                {
                New-Item -Path "C:\_Maintenance\BackupConfig\$filedate\$kiosk" -ItemType Directory
                 Compress-Archive -Path $sbcfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\SBCbackup"
                 Write-Output "SBC config backup successfully!"
                }

                    else
                    {
                    New-Item -Path "C:\_Maintenance\BackupConfig\$filedate\$kiosk" -ItemType Directory
                    Compress-Archive -Path $sbcRemediationfile -DestinationPath "C:\_Maintenance\BackupConfig\$filedate\$kiosk\SBCbackup"
                    Write-Output "SBCRemediation config backup successfully!"
                    }
  

    }



BackupConfig
